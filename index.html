<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>üì∏ Realtime Photo Gallery</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; background: #f9f9f9; }
    header { background: #2196f3; color: #fff; padding: 12px; text-align: center; }
    .upload-box { text-align: center; padding: 15px; background: #fff; }
    input, button { margin: 5px; padding: 8px 12px; border-radius: 6px; border: 1px solid #2196f3; }
    button { background: #2196f3; color: #fff; cursor: pointer; }
    .gallery { display: grid; grid-template-columns: repeat(auto-fill,minmax(120px,1fr)); gap: 10px; padding: 15px; }
    .gallery img { width: 100%; height: 120px; object-fit: cover; border-radius: 8px; }
  </style>
</head>
<body>
  <header>üì∏ Realtime Photo Gallery</header>

  <div class="upload-box">
    <input type="file" id="fileInput" accept="image/*">
    <button onclick="uploadPhoto()">Upload</button>
  </div>

  <div id="gallery" class="gallery"></div>

  <script>
    // üîπ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyD14Z3b7uCk62FBCK9SSZlczSxnMXndM1o",
      authDomain: "mp3-8247a.firebaseapp.com",
      databaseURL: "https://mp3-8247a-default-rtdb.firebaseio.com",
      projectId: "mp3-8247a",
      messagingSenderId: "228735051694",
      appId: "1:228735051694:web:99bdbbe737b66224ef4a3f"
    };
    firebase.initializeApp(firebaseConfig);
    const db=firebase.database();

    // üîπ Upload Function
    function uploadPhoto(){
      const file=document.getElementById("fileInput").files[0];
      if(!file){ alert("‡§™‡§π‡§≤‡•á ‡§´‡•ã‡§ü‡•ã ‡§ö‡•Å‡§®‡•á‡§Ç"); return; }

      const reader=new FileReader();
      reader.onload=function(e){
        const dataUrl=e.target.result;
        const base64=dataUrl.split(",")[1]; // ‡§∏‡§ø‡§∞‡•ç‡§´ base64 ‡§π‡§ø‡§∏‡•ç‡§∏‡§æ

        // üî∏ Chunk ‡§Æ‡•á‡§Ç ‡§§‡•ã‡§°‡§º‡§®‡§æ (50KB)
        const chunkSize=50000;
        const chunks={};
        for(let i=0;i<base64.length;i+=chunkSize){
          chunks[i/chunkSize]=base64.substring(i,i+chunkSize);
        }

        // üî∏ Firebase Save
        const key="img_"+Date.now();
        db.ref("images/"+key).set({
          name:file.name,
          mime:file.type,
          chunks:chunks
        })
        .then(()=>{ alert("‚úÖ ‡§´‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° ‡§π‡•ã ‡§ó‡§à!"); })
        .catch(err=>{ alert("‚ùå Error: "+err.message); });
      };
      reader.readAsDataURL(file);
    }

    // üîπ Load & Show All Images
    db.ref("images").on("value",snap=>{
      const data=snap.val()||{};
      const gallery=document.getElementById("gallery");
      gallery.innerHTML="";

      Object.keys(data).forEach(async key=>{
        const val=data[key];
        const chunks=val.chunks||{};
        const keys=Object.keys(chunks).sort((a,b)=>+a-+b);

        let base64="";
        for(let i=0;i<keys.length;i++){
          base64+=chunks[keys[i]];
        }

        const dataUrl=`data:${val.mime};base64,${base64}`;
        const img=document.createElement("img");
        img.src=dataUrl;
        img.title=val.name;
        gallery.appendChild(img);
      });
    });
  </script>
</body>
</html>
