<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PDF ‡§ï‡•Ç‡§™‡§® ‡§ú‡•á‡§®‡§∞‡•á‡§ü‡§∞</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
  body {font-family: sans-serif; background:#f0f2f5; padding:20px; display:flex; justify-content:center;}
  .main-container {background:white; padding:20px; border-radius:12px; max-width:460px; width:100%; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
  .header {display:flex; justify-content:space-between; align-items:center;}
  h2 {margin:0; color:#0d6efd;}
  .clear-all-btn {background:none; color:red; border:none; cursor:pointer;}
  .coupon-row {display:flex; gap:8px; align-items:center; margin-top:10px;}
  .coupon-row input {width:80px; padding:5px;}
  .card-count {flex-grow:1; font-size:14px; color:#555;}
  .delete-btn {background:#fbebee; color:red; border:none; border-radius:50%; width:28px; height:28px; cursor:pointer;}
  .add-row-btn {margin-top:10px; padding:8px; border:2px dashed #0d6efd; background:#e7f1ff; color:#0d6efd; cursor:pointer; width:100%;}
  .total-summary {margin-top:15px; background:#e7f1ff; color:#0d6efd; padding:10px; text-align:center; font-weight:bold;}
  label {display:block; margin-top:8px;}
  #preview-container {margin-top:20px; background:white; border:1px solid #ccc; aspect-ratio:210/297; width:100%; display:grid; grid-template-columns:repeat(10,1fr); grid-template-rows:repeat(15,1fr); gap:2px; padding:4px; box-sizing:border-box;}
  .card {border:1px solid #0d6efd; border-radius:8px; display:flex; flex-direction:column; align-items:center; justify-content:center; background:white; font-size:10px; padding:2px;}
  .card-title {font-weight:bold; color:#0d6efd; margin-bottom:3px; font-size:9px;}
  .num-box {border:1px solid #0d6efd; border-radius:4px; padding:2px 6px; color:#0d6efd; font-weight:600; font-size:10px; min-width:20px; text-align:center;}
  .generate-btn {margin-top:15px; background:#0d6efd; color:white; border:none; padding:12px; width:100%; font-size:16px; border-radius:8px; cursor:pointer;}
</style>
</head>
<body>
<div class="main-container">
  <div class="header">
    <h2>PDF ‡§ï‡•Ç‡§™‡§®</h2>
    <button class="clear-all-btn">‡§∏‡§¨ ‡§∏‡§æ‡§´‡§º</button>
  </div>
  <div id="rows-container"></div>
  <button class="add-row-btn" id="add-row-btn">+ ‡§®‡§Ø‡•Ä ‡§™‡§Ç‡§ï‡•ç‡§§‡§ø</button>
  <div class="total-summary">‡§ï‡•Å‡§≤: <span id="total-cards-display">0</span></div>
  <label>PDF ‡§ï‡•ç‡§µ‡§æ‡§≤‡§ø‡§ü‡•Ä:
    <select id="quality-select">
      <option value="2">‡§°‡•ç‡§∞‡§æ‡§´‡§º‡•ç‡§ü</option>
      <option value="4" selected>HD</option>
      <option value="10">‡§Ö‡§≤‡•ç‡§ü‡•ç‡§∞‡§æ HD</option>
    </select>
  </label>
  <div id="preview-container"></div>
  <button class="generate-btn" id="generate-pdf-btn">üìÑ PDF ‡§¨‡§®‡§æ‡§è‡§Ç</button>
</div>

<script>
const { jsPDF } = window.jspdf;
const A4_WIDTH = 210, A4_HEIGHT = 297;
const COLS = 10, ROWS = 15;

const dom = {
  rowsContainer: document.getElementById('rows-container'),
  addRowBtn: document.getElementById('add-row-btn'),
  totalCardsDisplay: document.getElementById('total-cards-display'),
  clearAllBtn: document.querySelector('.clear-all-btn'),
  generatePdfBtn: document.getElementById('generate-pdf-btn'),
  qualitySelect: document.getElementById('quality-select'),
  preview: document.getElementById('preview-container')
};

function getAllCouponNumbers() {
  const numbers = [];
  dom.rowsContainer.querySelectorAll('.coupon-row').forEach(row => {
    const start = parseInt(row.querySelector('.start-num').value, 10);
    const end = parseInt(row.querySelector('.end-num').value, 10);
    if (!isNaN(start) && !isNaN(end) && end >= start) {
      for (let i = start; i <= end; i++) numbers.push(i);
    }
  });
  return numbers;
}

function createNewRow(startVal = '', endVal = '') {
  const row = document.createElement('div');
  row.className = 'coupon-row';
  row.innerHTML = `
    <input type="number" class="start-num" placeholder="‡§∂‡•Å‡§∞‡•Ç" value="${startVal}">
    <span>‡§∏‡•á</span>
    <input type="number" class="end-num" placeholder="‡§Ö‡§Ç‡§§" value="${endVal}">
    <span class="card-count">=0</span>
    <button class="delete-btn">√ó</button>
  `;
  dom.rowsContainer.appendChild(row);
  updateTotals();
}

function updatePreview() {
  const numbers = getAllCouponNumbers();
  dom.preview.innerHTML = '';
  let i=0;
  for(let r=0; r<ROWS; r++) {
    for(let c=0; c<COLS; c++) {
      const card = document.createElement('div');
      card.className = 'card';
      if(i < numbers.length) {
        const title = document.createElement('div');
        title.className = 'card-title';
        title.textContent = '‡§á‡§®‡§æ‡§Æ';
        const numBox = document.createElement('div');
        numBox.className = 'num-box';
        numBox.textContent = numbers[i];
        card.appendChild(title);
        card.appendChild(numBox);
      }
      dom.preview.appendChild(card);
      i++;
    }
  }
}

function updateTotals() {
  let total = 0;
  document.querySelectorAll('.coupon-row').forEach(row => {
    const start = parseInt(row.querySelector('.start-num').value, 10);
    const end = parseInt(row.querySelector('.end-num').value, 10);
    let count = 0;
    if (!isNaN(start) && !isNaN(end) && end >= start) count = end - start + 1;
    row.querySelector('.card-count').textContent = `=${count}`;
    total += count;
  });
  dom.totalCardsDisplay.textContent = total;
  updatePreview();
}

async function generatePdf() {
  const numbers = getAllCouponNumbers();
  if (numbers.length === 0) {
    alert("‡§™‡§π‡§≤‡•á ‡§ï‡•Ç‡§™‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§°‡§æ‡§≤‡•á‡§Ç!");
    return;
  }
  const pageCapacity = COLS * ROWS;
  const totalPages = Math.ceil(numbers.length / pageCapacity);
  const doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
  const qualityScale = parseFloat(dom.qualitySelect.value);

  const previewElement = dom.preview;
  for (let p = 0; p < totalPages; p++) {
    const startIdx = p * pageCapacity;
    const pageData = numbers.slice(startIdx, startIdx + pageCapacity);

    // ‡§™‡•ç‡§∞‡•Ä‡§µ‡•ç‡§Ø‡•Ç ‡§Æ‡•á‡§Ç ‡§´‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§≤‡§ó‡§æ‡§ï‡§∞ ‡§∏‡§ø‡§∞‡•ç‡§´ ‡§á‡§∏ ‡§™‡•á‡§ú ‡§ï‡•á ‡§≤‡§ø‡§è
    dom.preview.querySelectorAll('.card').forEach((card, idx) => {
      const num = pageData[idx];
      card.querySelector('.num-box')?.remove();
      card.querySelector('.card-title')?.remove();
      if(idx < pageData.length) {
        const title = document.createElement('div');
        title.className = 'card-title';
        title.textContent = '‡§á‡§®‡§æ‡§Æ';
        const numBox = document.createElement('div');
        numBox.className = 'num-box';
        numBox.textContent = num;
        card.appendChild(title);
        card.appendChild(numBox);
      }
    });

    await new Promise(r => setTimeout(r, 50));
    const canvas = await html2canvas(previewElement, {scale: qualityScale, backgroundColor:'#fff'});
    const imgData = canvas.toDataURL('image/png');
    if(p>0) doc.addPage();
    doc.addImage(imgData, 'PNG', 0, 0, A4_WIDTH, A4_HEIGHT);
  }

  doc.save("Coupons.pdf");
}

// Events
dom.addRowBtn.addEventListener('click', () => createNewRow());
dom.rowsContainer.addEventListener('input', updateTotals);
dom.rowsContainer.addEventListener('click', e => {
  if (e.target.classList.contains('delete-btn')) {
    e.target.closest('.coupon-row').remove();
    updateTotals();
  }
});
dom.clearAllBtn.addEventListener('click', () => {
  dom.rowsContainer.innerHTML = '';
  updateTotals();
});
dom.generatePdfBtn.addEventListener('click', generatePdf);

// Init
createNewRow();
updatePreview();
</script>
</body>
</html>
