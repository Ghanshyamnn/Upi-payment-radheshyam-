<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Final Notification Demo</title>
  <style>
    body { font-family: sans-serif; padding: 24px; max-width: 600px; margin:auto; line-height:1.5; }
    h1 { font-size: 1.5rem; margin-bottom: 12px; }
    button { padding: 10px 16px; margin: 6px; border-radius: 6px; border: 1px solid #ccc; cursor: pointer; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    #log { margin-top:16px; padding:12px; border-radius:6px; background:#f9f9f9; border:1px solid #ddd; min-height:40px; white-space:pre-line; }
  </style>
</head>
<body>
  <h1>üîî Notification Demo (Final)</h1>
  <p>‡§Ø‡§π demo ‡§ï‡•á‡§µ‡§≤ <b>ServiceWorkerRegistration.showNotification()</b> ‡§∏‡•á ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§</p>

  <button id="btn-request">‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§Æ‡§æ‡§Å‡§ó‡•á</button>
  <button id="btn-test" disabled>‡§ü‡•á‡§∏‡•ç‡§ü ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§≠‡•á‡§ú‡•á‡§Ç</button>
  <button id="btn-perm">‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§ñ‡•á‡§Ç</button>

  <div id="log">‡§≤‡•â‡§ó ‡§Ø‡§π‡§æ‡§Å ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ‚Ä¶</div>

<script>
(async function(){
  const logEl = document.getElementById('log');
  const $ = id => document.getElementById(id);

  function log(...msg){
    const line = new Date().toLocaleTimeString() + " ‚Äî " + msg.join(' ');
    logEl.innerText = line + "\n" + logEl.innerText;
    console.log(...msg);
  }

  // --- Service Worker (inline) ---
  const swCode = `
    self.addEventListener('install', e => self.skipWaiting());
    self.addEventListener('activate', e => e.waitUntil(self.clients.claim()));
    self.addEventListener('notificationclick', e => {
      e.notification.close();
      e.waitUntil(clients.openWindow('/'));
    });
  `;
  const swUrl = URL.createObjectURL(new Blob([swCode], {type:'text/javascript'}));
  let registration = null;
  try {
    registration = await navigator.serviceWorker.register(swUrl);
    log("Service Worker registered:", registration.scope);
  } catch(err) {
    log("Service Worker error:", err);
  }

  // Notification icon (SVG data URL)
  const iconUrl = 'data:image/svg+xml;utf8,' + encodeURIComponent(
    '<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128">' +
    '<rect width="100%" height="100%" fill="#3b82f6"/>' +
    '<text x="50%" y="54%" font-size="60" text-anchor="middle" fill="white">üîî</text>' +
    '</svg>'
  );

  function updateUI(){
    const perm = Notification.permission;
    $('btn-request').disabled = (perm === 'granted');
    $('btn-test').disabled = (perm !== 'granted');
    log("Current permission:", perm);
  }
  updateUI();

  // ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§Æ‡§æ‡§Å‡§ó‡§®‡§æ
  $('btn-request').onclick = async () => {
    const result = await Notification.requestPermission();
    updateUI();
    if(result === 'granted'){
      await registration.showNotification("‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!", {
        body: "‡§Ü‡§™‡§®‡•á ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á ‡§¶‡•Ä ‚úÖ",
        icon: iconUrl,
        badge: iconUrl,
        vibrate: [200,100,200]
      });
    } else {
      log("User ‡§®‡•á ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•Ä:", result);
    }
  };

  // ‡§ü‡•á‡§∏‡•ç‡§ü ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§®
  $('btn-test').onclick = async () => {
    await registration.showNotification("‡§ü‡•á‡§∏‡•ç‡§ü ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§®", {
      body: "‡§Ø‡§π ServiceWorker ‡§∏‡•á ‡§≠‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ ‡§è‡§ï ‡§ü‡•á‡§∏‡•ç‡§ü ‡§π‡•à‡•§",
      icon: iconUrl,
      badge: iconUrl,
      tag: "demo",
      actions: [
        {action:"open", title:"Open"},
        {action:"dismiss", title:"Dismiss"}
      ]
    });
    log("‡§ü‡•á‡§∏‡•ç‡§ü ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§≠‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ‡•§");
  };

  // Permission status ‡§¶‡§ø‡§ñ‡§æ‡§®‡§æ
  $('btn-perm').onclick = () => {
    log("Current permission:", Notification.permission);
  };

  // Auto refresh every 2 seconds
  let lastPerm = Notification.permission;
  setInterval(() => {
    if(Notification.permission !== lastPerm){
      lastPerm = Notification.permission;
      updateUI();
    }
  }, 2000);

})();
</script>
</body>
</html>