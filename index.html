<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Notification Permission ‚Äî Single File Demo</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans", sans-serif; padding: 28px; max-width: 680px; margin: auto; line-height: 1.5; }
    h1 { font-size: 1.4rem; margin-bottom: 8px; }
    button { padding: 10px 14px; margin-right: 8px; border-radius: 8px; border: 1px solid #ccc; background:#f6f6f6; cursor:pointer; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    pre { background:#111; color:#0f0; padding:12px; border-radius:8px; overflow:auto; }
    .log { margin-top:12px; padding:10px; border-radius:8px; background:#fafafa; border:1px solid #eee; min-height:40px;}
  </style>
</head>
<body>
  <h1>‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‚Äî Single File (‡§´‡§º‡•Å‡§≤ ‡§µ‡§∞‡•ç‡§ï‡§ø‡§Ç‡§ó)</h1>
  <p>‡§¨‡§ü‡§® ‡§¶‡§¨‡§æ‡§ï‡§∞ ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§Æ‡§æ‡§Å‡§ó‡•á ‡§î‡§∞ ‡§´‡§ø‡§∞ ‡§ü‡•á‡§∏‡•ç‡§ü ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§≠‡•á‡§ú‡•á‡§Ç‡•§</p>

  <div>
    <button id="btn-request">‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§Æ‡§æ‡§Å‡§ó‡•á</button>
    <button id="btn-test" disabled>‡§ü‡•á‡§∏‡•ç‡§ü ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§≠‡•á‡§ú‡•á‡§Ç</button>
    <button id="btn-perm">‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§ñ‡•á‡§Ç</button>
  </div>

  <div class="log" id="log">‡§≤‡•â‡§ó ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ ‡§Ø‡§π‡§æ‡§Å‚Ä¶</div>

<script>
(async function(){
  const logEl = document.getElementById('log');
  const $ = id => document.getElementById(id);

  function log(...args){
    const t = new Date().toLocaleTimeString();
    logEl.innerText = t + " ‚Äî " + args.join(' ');
    console.log(...args);
  }

  // 1) Inline service-worker ‡§¨‡§®‡§æ‡§§‡•á ‡§π‡•à‡§Ç (Blob ‡§ï‡•á ‡§ú‡§∞‡§ø‡§è) ‚Äî ‡§§‡§æ‡§ï‡§ø ‡§Ø‡§π ‡§è‡§ï single-file solution ‡§π‡•ã.
  const swCode = `
self.addEventListener('install', event => {
  self.skipWaiting();
});
self.addEventListener('activate', event => {
  event.waitUntil(self.clients.claim());
});
// notification click handling
self.addEventListener('notificationclick', function(event) {
  event.notification.close();
  // ‡§ï‡§ø‡§∏‡•Ä ‡§ü‡•à‡§¨ ‡§ï‡•ã ‡§´‡•ã‡§ï‡§∏/‡§ì‡§™‡§® ‡§ï‡§∞‡§®‡§æ
  event.waitUntil(
    clients.matchAll({type: 'window'}).then(windowClients => {
      for (let client of windowClients) {
        if ('focus' in client) return client.focus();
      }
      if (clients.openWindow) return clients.openWindow('/');
    })
  );
});
`;

  // create blob URL for SW
  const blob = new Blob([swCode], {type: 'text/javascript'});
  const swUrl = URL.createObjectURL(blob);

  let registration = null;
  if ('serviceWorker' in navigator) {
    try {
      registration = await navigator.serviceWorker.register(swUrl);
      log('Service Worker registered (inline blob). scope=' + registration.scope);
    } catch (e) {
      log('Service Worker ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§è‡§∞‡§∞:', e);
    }
  } else {
    log('Service Worker ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à ‡§á‡§∏ ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§Æ‡•á‡§Ç‡•§');
  }

  // data URL icon (small SVG) ‚Äî ‡§ï‡•ã‡§à external assets ‡§®‡§π‡•Ä‡§Ç ‡§ö‡§æ‡§π‡§ø‡§è
  const svgIcon = encodeURIComponent(
    '<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128">' +
    '<rect width="100%" height="100%" fill="#3b82f6"/>' +
    '<text x="50%" y="54%" font-size="60" text-anchor="middle" fill="white" style="font-family: Arial, Helvetica, sans-serif">üîî</text>' +
    '</svg>'
  );
  const iconUrl = 'data:image/svg+xml;utf8,' + svgIcon;

  // Helper: check permission and update UI
  function updateUIByPermission() {
    const perm = Notification.permission;
    $('btn-request').disabled = (perm === 'granted');
    $('btn-test').disabled = (perm !== 'granted');
    log('Current permission:', perm);
  }

  updateUIByPermission();

  // Request permission button
  $('btn-request').addEventListener('click', async () => {
    if (!('Notification' in window)) {
      log('‡§Ø‡§π ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ Notifications API ‡§ï‡•ã ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ‡•§');
      return;
    }

    try {
      const result = await Notification.requestPermission();
      log('requestPermission result:', result);
      updateUIByPermission();

      if (result === 'granted') {
        // optional: ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§è‡§ï ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Å
        showTestNotification('‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!', { body: '‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§Æ‡§ø‡§≤ ‡§ó‡§Ø‡•Ä ‡§π‡•à‡•§', requireInteraction: false });
      } else if (result === 'denied') {
        log('‡§Ø‡•Ç‡§ú‡§º‡§∞ ‡§®‡•á ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§Æ‡§®‡§æ ‡§ï‡§∞ ‡§¶‡•Ä‡•§ ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§∏‡•á ‡§¨‡§¶‡§≤‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§');
      } else {
        log('‡§Ø‡•Ç‡§ú‡§º‡§∞ ‡§®‡•á ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ ‡§õ‡•ã‡§°‡§º‡§æ / default‡•§');
      }
    } catch (err) {
      log('permission ‡§Æ‡§æ‡§Å‡§ó‡§§‡•á ‡§∏‡§Æ‡§Ø error:', err);
    }
  });

  // Show notification function (tries ServiceWorker registration first)
  async function showTestNotification(title = '‡§ü‡•á‡§∏‡•ç‡§ü ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§®', options = {}) {
    const opts = Object.assign({
      body: '‡§Ø‡§π ‡§è‡§ï ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§ü‡•á‡§∏‡•ç‡§ü ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§π‡•à‡•§',
      icon: iconUrl,
      badge: iconUrl,
      vibrate: [100,50,100],
      tag: 'single-file-demo',
      data: { time: Date.now() },
      requireInteraction: false, // true ‡§∞‡§ñ‡•ã‡§ó‡•á ‡§§‡•ã ‡§®‡•ã‡§ü‡§ø‡§´‡§º ‡§ï‡•Ä‡§¨‡•ã‡§∞‡•ç‡§°/‡§ï‡•ç‡§≤‡•ã‡§ú ‡§§‡§ï ‡§∞‡§π‡•á‡§ó‡§æ
      actions: [
        {action: 'open', title: 'Open', icon: iconUrl},
        {action: 'dismiss', title: 'Dismiss'}
      ]
    }, options);

    if (registration && registration.showNotification) {
      try {
        await registration.showNotification(title, opts);
        log('Notification shown via Service Worker:', title);
        return;
      } catch (e) {
        console.warn('registration.showNotification failed, fallback to new Notification', e);
      }
    }

    // Fallback: direct Notification (works on main thread in many browsers)
    try {
      const n = new Notification(title, opts);
      log('Notification shown via new Notification():', title);
      // optional click handler (only works on some browsers for main-thread notifications)
      n.onclick = (ev) => {
        window.focus();
        n.close();
      };
    } catch (err) {
      log('Notification ‡§¶‡§ø‡§ñ‡§æ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§è‡§∞‡§∞:', err);
    }
  }

  // Test button
  $('btn-test').addEventListener('click', () => {
    showTestNotification('‡§π‡•à‡§≤‡•ã!', { body: '‡§Ø‡§π ‡§Ü‡§™‡§ï‡§æ ‡§ü‡•á‡§∏‡•ç‡§ü ‡§®‡•ã‡§ü‡§ø‡§´‡§ø‡§ï‡•á‡§∂‡§® ‡§π‡•à ‚Äî Single-file example.' });
  });

  // Show current permission
  $('btn-perm').addEventListener('click', () => {
    log('Permission:', Notification.permission);
  });

  // Auto update UI if permission changes (some browsers fire permissionchange? fallback: poll)
  // Polling every 2s for visibility only when tab active (lightweight)
  let lastPerm = Notification.permission;
  setInterval(() => {
    if (Notification.permission !== lastPerm) {
      lastPerm = Notification.permission;
      updateUIByPermission();
    }
  }, 2000);

  // Final log
  log('Demo ready. Permission:', Notification.permission);
})();
</script>
</body>
</html>