<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>рд▓реЛрдХ рдореИрдиреЗрдЬрдореЗрдВрдЯ + MP3</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: "Segoe UI", sans-serif; background:#f2f4f7; margin:0; padding:0; }
    header {
      background:#007bff; color:white; 
      display:flex; justify-content:space-between; align-items:center;
      padding:15px; font-size:18px; position:sticky; top:0;
    }
    header span { font-weight:bold; }
    header button { background:none; border:none; color:white; font-size:22px; cursor:pointer; }

    main { padding:15px; max-width:600px; margin:auto; }

    .btn { padding:14px; border:none; border-radius:10px; cursor:pointer; font-size:16px; width:100%; margin-top:12px; transition:0.2s; }
    .btn-primary { background:#007bff; color:white; }
    .btn-primary:hover { background:#0056d2; }
    .btn-secondary { background:#6c757d; color:white; }
    .btn-secondary:hover { background:#555; }

    input[type=text], input[type=file] { 
      width:100%; padding:14px; margin:10px 0; border:1px solid #ddd; border-radius:10px; font-size:15px; 
    }

    .popup {
      display:none; position:fixed; top:0; left:0; right:0; bottom:0;
      background:rgba(0,0,0,0.6); justify-content:center; align-items:flex-end;
      z-index:1000;
    }
    .popup-content {
      background:white; padding:20px; border-radius:15px 15px 0 0; width:100%; max-width:500px;
      animation: slideUp 0.3s ease-in-out;
    }
    @keyframes slideUp { from{transform:translateY(100%);} to{transform:translateY(0);} }

    .label { font-size:14px; font-weight:600; margin-top:8px; display:block; }
    .card {
      background:white; padding:15px; border-radius:12px; box-shadow:0 3px 6px rgba(0,0,0,0.1);
      margin-top:15px;
    }
    .card h3, .card h4 { margin:0 0 10px 0; }
    audio { width:100%; margin-top:8px; }

    details summary { cursor:pointer; color:#007bff; margin-top:8px; font-size:14px; }
  </style>
</head>
<body onload="openPopup()">
  <!-- Header -->
  <header>
    <span>ЁЯУС рд▓реЛрдХ рдореИрдиреЗрдЬрдореЗрдВрдЯ</span>
    <button onclick="openPopup()">ЁЯФН</button>
  </header>

  <main>
    <div id="userLok" style="display:none;"></div>

    <h3 style="margin-top:25px;">ЁЯО╡ MP3 рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ</h3>
    <input type="file" id="mp3File" accept="audio/mp3" />
    <button class="btn btn-primary" onclick="uploadMp3()">тмЖя╕П рдЕрдкрд▓реЛрдб</button>

    <h3 style="margin-top:25px;">ЁЯО╢ рдЧрд╛рдиреЛрдВ рдХреА рд▓рд┐рд╕реНрдЯ</h3>
    <div id="songs"></div>
  </main>

  <!-- Popup -->
  <div class="popup" id="popup">
    <div class="popup-content" id="searchSection">
      <h3 style="text-align:center;">ЁЯУВ рд▓реЛрдХ рдЦреЛрд▓реЗрдВ / рдирдпрд╛ рдмрдирд╛рдПрдБ</h3>
      <label class="label">рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░</label>
      <input type="text" id="searchMobile" placeholder="рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░ рдбрд╛рд▓реЗрдВ">
      <label class="label">рдкрд╛рд╕рдкреЛрд░реНрдЯ рдирдВрдмрд░</label>
      <input type="text" id="searchPassport" placeholder="рдкрд╛рд╕рдкреЛрд░реНрдЯ рдирдВрдмрд░ рдбрд╛рд▓реЗрдВ">
      <button class="btn btn-primary" onclick="searchLok()">ЁЯФН рдЦреЛрдЬреЗрдВ</button>
      <button class="btn btn-secondary" onclick="showAddForm()">тЮХ рдирдпрд╛ рд▓реЛрдХ рдмрдирд╛рдПрдБ</button>
    </div>

    <div class="popup-content" id="addSection" style="display:none;">
      <h3 style="text-align:center;">тЮХ рдирдпрд╛ рд▓реЛрдХ рдмрдирд╛рдПрдБ</h3>
      <label class="label">рдирд╛рдо</label>
      <input type="text" id="name" placeholder="рдирд╛рдо рдбрд╛рд▓реЗрдВ">
      <label class="label">рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░</label>
      <input type="text" id="mobile" placeholder="рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░ рдбрд╛рд▓реЗрдВ">
      <label class="label">рдкрд╛рд╕рдкреЛрд░реНрдЯ рдирдВрдмрд░</label>
      <input type="text" id="passport" placeholder="рдкрд╛рд╕рдкреЛрд░реНрдЯ рдирдВрдмрд░ рдбрд╛рд▓реЗрдВ">
      <button class="btn btn-primary" onclick="saveLok()">ЁЯТ╛ рд╕реЗрд╡ рдХрд░реЗрдВ</button>
      <button class="btn btn-secondary" onclick="showSearchForm()">тЖйя╕П рд╡рд╛рдкрд╕</button>
    </div>
  </div>

  <script>
    // тЬЕ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyD14Z3b7uCk62FBCK9SSZlczSxnMXndM1o",
      authDomain: "mp3-8247a.firebaseapp.com",
      databaseURL: "https://mp3-8247a-default-rtdb.firebaseio.com",
      projectId: "mp3-8247a",
      storageBucket: "mp3-8247a.appspot.com",
      messagingSenderId: "228735051694",
      appId: "1:228735051694:web:99bdbbe737b66224ef4a3f"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Popup Controls
    function openPopup() { document.getElementById("popup").style.display = "flex"; showSearchForm(); }
    function showAddForm() { document.getElementById("searchSection").style.display = "none"; document.getElementById("addSection").style.display = "block"; }
    function showSearchForm() { document.getElementById("searchSection").style.display = "block"; document.getElementById("addSection").style.display = "none"; }

    // Save Lok
    function saveLok() {
      const name = document.getElementById("name").value.trim();
      const mobile = document.getElementById("mobile").value.trim();
      const passport = document.getElementById("passport").value.trim();
      if (!name || !mobile || !passport) { alert("тЪая╕П рд╕рднреА рдлрд╝реАрд▓реНрдб рднрд░реЗрдВ"); return; }
      db.ref("loks").push({ name, mobile, passport, createdAt: new Date().toISOString() });
      alert("тЬЕ рд▓реЛрдХ рд╕реЗрд╡ рд╣реЛ рдЧрдпрд╛!");
      showSearchForm();
    }

    // Search Lok
    function searchLok() {
      const mobile = document.getElementById("searchMobile").value.trim();
      const passport = document.getElementById("searchPassport").value.trim();
      if (!mobile || !passport) { alert("тЪая╕П рдореЛрдмрд╛рдЗрд▓ рдФрд░ рдкрд╛рд╕рдкреЛрд░реНрдЯ рдбрд╛рд▓реЗрдВ"); return; }

      db.ref("loks").orderByChild("mobile").equalTo(mobile).once("value", snap => {
        let found = false;
        snap.forEach(child => {
          const data = child.val();
          if (data.passport === passport) {
            document.getElementById("popup").style.display = "none";
            document.getElementById("userLok").style.display = "block";
            document.getElementById("userLok").innerHTML = `
              <div class="card">
                <h3>тЬЕ рд▓реЛрдХ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдЦреЛрд▓рд╛ рдЧрдпрд╛</h3>
                <p><b>рдирд╛рдо:</b> ${data.name}</p>
                <details>
                  <summary>тД╣я╕П рдФрд░ рдЬрд╛рдирдХрд╛рд░реА</summary>
                  <p><b>рдореЛрдмрд╛рдЗрд▓:</b> ${data.mobile}</p>
                  <p><b>рдкрд╛рд╕рдкреЛрд░реНрдЯ:</b> ${data.passport}</p>
                </details>
              </div>`;
            found = true;
          }
        });
        if (!found) { alert("тЭМ рдХреЛрдИ рдбреЗрдЯрд╛ рдирд╣реАрдВ рдорд┐рд▓рд╛"); }
      });
    }

    // Upload MP3
    function uploadMp3() {
      const fileInput = document.getElementById("mp3File");
      const file = fileInput.files[0];
      if (!file) { alert("тЪая╕П рдкрд╣рд▓реЗ MP3 рдЪреБрдиреЗрдВ"); return; }
      const reader = new FileReader();
      reader.onload = function(e) {
        const base64 = e.target.result.split(",")[1];
        db.ref("mp3s").push({ filename: file.name, base64 });
        alert("тЬЕ MP3 рдЕрдкрд▓реЛрдб рд╣реЛ рдЧрдпрд╛!");
        fileInput.value = "";
      };
      reader.readAsDataURL(file);
    }

    // Show MP3 Songs
    firebase.database().ref("mp3s").on("value", snap => {
      const container = document.getElementById("songs");
      container.innerHTML = "";
      if (!snap.exists()) { container.innerHTML = "<p>тЭМ рдХреЛрдИ рдЧрд╛рдирд╛ рдирд╣реАрдВ рдорд┐рд▓рд╛</p>"; return; }
      const data = snap.val();
      Object.keys(data).forEach(id => {
        const song = data[id];
        const src = `data:audio/mpeg;base64,${song.base64}`;
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <h4>ЁЯО╡ ${song.filename || "Untitled.mp3"}</h4>
          <audio controls preload="none" src="${src}"></audio>
        `;
        container.appendChild(div);
      });
    });
  </script>
</body>
</html>
