<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <title>Single File Notification Demo</title>
</head>
<body>
  <h1>ЁЯФФ Single File Notification Demo</h1>
  <button id="btn-request">рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рдЕрдиреБрдорддрд┐ рдорд╛рдБрдЧреЗ</button>
  <button id="btn-test" disabled>рдЯреЗрд╕реНрдЯ рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рднреЗрдЬреЗрдВ</button>
  <div id="log">рд▓реЙрдЧ рдпрд╣рд╛рдБ рджрд┐рдЦреЗрдЧрд╛тАж</div>

<script id="sw" type="javascript/worker">
self.addEventListener('install', e => self.skipWaiting());
self.addEventListener('activate', e => e.waitUntil(self.clients.claim()));
self.addEventListener('notificationclick', e => {
  e.notification.close();
  e.waitUntil(clients.openWindow('/'));
});
</script>

<script>
(async function(){
  const logEl = document.getElementById('log');
  function log(msg){ logEl.innerText = msg; console.log(msg); }

  // Service Worker рдХреЛ inline script рд╕реЗ рдирд┐рдХрд╛рд▓рдирд╛
  const swBlob = new Blob([document.getElementById('sw').textContent], {type:'text/javascript'});
  const swUrl = URL.createObjectURL(swBlob);

  let registration = null;
  try {
    registration = await navigator.serviceWorker.register(swUrl);
    log("Service Worker registered тЬЕ");
  } catch(err){
    log("SW error: " + err);
    return;
  }

  function updateUI(){
    document.getElementById('btn-request').disabled = (Notification.permission === 'granted');
    document.getElementById('btn-test').disabled = (Notification.permission !== 'granted');
    log("Permission: " + Notification.permission);
  }
  updateUI();

  document.getElementById('btn-request').onclick = async () => {
    const perm = await Notification.requestPermission();
    updateUI();
    if(perm === 'granted'){
      registration.showNotification("рдзрдиреНрдпрд╡рд╛рдж!", { body:"рдЖрдкрдиреЗ рдЕрдиреБрдорддрд┐ рджреЗ рджреА тЬЕ" });
    }
  };

  document.getElementById('btn-test').onclick = async () => {
    await registration.showNotification("рдЯреЗрд╕реНрдЯ рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди", {
      body:"рдпрд╣ ServiceWorker рд╕реЗ рднреЗрдЬрд╛ рдЧрдпрд╛ рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рд╣реИред"
    });
  };
})();
</script>
</body>
</html>